/******************************************************************************
 *
 * Filename: dvr_DAC0.c
 *
 * Global Designator: DVR_DAC0_
 *
 * Contents: Contains the driver for DAC0 module
 *
 ******************************************************************************
 * A product of
 * Aclara Technologies LLC
 * Confidential and Proprietary
 * Copyright 2020-2022 Aclara.  All Rights Reserved.
 *
 * PROPRIETARY NOTICE
 * The information contained in this document is private to Aclara Technologies LLC an Ohio limited liability company
 * (Aclara).  This information may not be published, reproduced, or otherwise disseminated without the express written
 * authorization of Aclara.  Any software or firmware described in this document is furnished under a license and may
 * be used or copied only in accordance with the terms of such license.
 *****************************************************************************/

/* ****************************************************************************************************************** */
/* INCLUDE FILES */
#include "project.h"
#if ( MCU_SELECTED == RA6E1 )
#include "hal_data.h"
#endif

#if ( MCU_SELECTED == NXP_K24 )
#if ( DAC_CODE_CONFIG == 1 )
#include "dvr_DAC0.h"
#include "PHY.h"
#include "DBG_SerialDebug.h"
#include "math.h"
#include "UplinkPower_Control.h"
#include "radio.h"
#include "radio_hal.h"

/* ****************************************************************************************************************** */
/* #DEFINE DEFINITIONS */

PACK_BEGIN
typedef struct
{
   uint16_t   frequencyMHz;
   int8_t     dBM;
   uint16_t   dacStep;
   int8_t     temperature;
} struct_DAC_Lookup;
PACK_END

/* CONSTANTS */
static const struct_DAC_Lookup struct_dacSoteps[1188] =
{
{ 452,-20,1486,-40    },
{ 452,-15,1770,-40    },
{ 452,-10,2081,-40    },
{ 452,-5,2141,-40     },
{ 452,0,2181,-40      },
{ 452,5,2223,-40      },
{ 452,10,2271,-40     },
{ 452,15,2327,-40     },
{ 452,20,2417,-40     },
{ 452,25,2577,-40     },
{ 452,30,3421,-40     },
{ 456,-20,1206,-40    },
{ 456,-15,1523,-40    },
{ 456,-10,1910,-40    },
{ 456,-5,1980,-40     },
{ 456,0,2026,-40      },
{ 456,5,2073,-40      },
{ 456,10,2125,-40     },
{ 456,15,2197,-40     },
{ 456,20,2304,-40     },
{ 456,25,2482,-40     },
{ 456,30,3444,-40     },
{ 457,-20,1170,-40    },
{ 457,-15,1485,-40    },
{ 457,-10,1886,-40    },
{ 457,-5,1959,-40     },
{ 457,0,2005,-40      },
{ 457,5,2053,-40      },
{ 457,10,2107,-40     },
{ 457,15,2180,-40     },
{ 457,20,2291,-40     },
{ 457,25,2473,-40     },
{ 457,30,3394,-40     },
{ 458,-20,1128,-40    },
{ 458,-15,1453,-40    },
{ 458,-10,1861,-40    },
{ 458,-5,1937,-40     },
{ 458,0,1984,-40      },
{ 458,5,2032,-40      },
{ 458,10,2089,-40     },
{ 458,15,2161,-40     },
{ 458,20,2274,-40     },
{ 458,25,2461,-40     },
{ 458,30,3406,-40     },
{ 462,-20,794,-40     },
{ 462,-15,1162,-40    },
{ 462,-10,1663,-40    },
{ 462,-5,1762,-40     },
{ 462,0,1817,-40      },
{ 462,5,1873,-40      },
{ 462,10,1941,-40     },
{ 462,15,2035,-40     },
{ 462,20,2172,-40     },
{ 462,25,2387,-40     },
{ 462,30,3406,-40     },
{ 452,-20,1466,-30    },
{ 452,-15,1753,-30    },
{ 452,-10,2051,-30    },
{ 452,-5,2109,-30     },
{ 452,0,2151,-30      },
{ 452,5,2194,-30      },
{ 452,10,2244,-30     },
{ 452,15,2304,-30     },
{ 452,20,2399,-30     },
{ 452,25,2566,-30     },
{ 452,30,3598,-30     },
{ 456,-20,1192,-30    },
{ 456,-15,1511,-30    },
{ 456,-10,1886,-30    },
{ 456,-5,1955,-30     },
{ 456,0,2003,-30      },
{ 456,5,2050,-30      },
{ 456,10,2106,-30     },
{ 456,15,2180,-30     },
{ 456,20,2297,-30     },
{ 456,25,2486,-30     },
{ 456,30,3460,-30     },
{ 457,-20,1151,-30    },
{ 457,-15,1475,-30    },
{ 457,-10,1864,-30    },
{ 457,-5,1934,-30     },
{ 457,0,1982,-30      },
{ 457,5,2030,-30      },
{ 457,10,2089,-30     },
{ 457,15,2164,-30     },
{ 457,20,2282,-30     },
{ 457,25,2473,-30     },
{ 457,30,3375,-30     },
{ 458,-20,1110,-30    },
{ 458,-15,1444,-30    },
{ 458,-10,1839,-30    },
{ 458,-5,1914,-30     },
{ 458,0,1963,-30      },
{ 458,5,2012,-30      },
{ 458,10,2072,-30     },
{ 458,15,2149,-30     },
{ 458,20,2273,-30     },
{ 458,25,2468,-30     },
{ 458,30,3368,-30     },
{ 462,-20,793,-30     },
{ 462,-15,1181,-30    },
{ 462,-10,1660,-30    },
{ 462,-5,1751,-30     },
{ 462,0,1806,-30      },
{ 462,5,1863,-30      },
{ 462,10,1934,-30     },
{ 462,15,2032,-30     },
{ 462,20,2181,-30     },
{ 462,25,2408,-30     },
{ 462,30,3560,-30     },
{ 452,-20,1430,-20    },
{ 452,-15,1743,-20    },
{ 452,-10,2021,-20    },
{ 452,-5,2078,-20     },
{ 452,0,2122,-20      },
{ 452,5,2167,-20      },
{ 452,10,2218,-20     },
{ 452,15,2286,-20     },
{ 452,20,2384,-20     },
{ 452,25,2563,-20     },
{ 452,30,3626,-20     },
{ 456,-20,1165,-20    },
{ 456,-15,1503,-20    },
{ 456,-10,1861,-20    },
{ 456,-5,1930,-20     },
{ 456,0,1979,-20      },
{ 456,5,2031,-20      },
{ 456,10,2091,-20     },
{ 456,15,2168,-20     },
{ 456,20,2291,-20     },
{ 456,25,2492,-20     },
{ 456,30,3512,-20     },
{ 457,-20,1131,-20    },
{ 457,-15,1473,-20    },
{ 457,-10,1841,-20    },
{ 457,-5,1911,-20     },
{ 457,0,1959,-20      },
{ 457,5,2012,-20      },
{ 457,10,2072,-20     },
{ 457,15,2152,-20     },
{ 457,20,2279,-20     },
{ 457,25,2483,-20     },
{ 457,30,3389,-20     },
{ 458,-20,1096,-20    },
{ 458,-15,1443,-20    },
{ 458,-10,1819,-20    },
{ 458,-5,1892,-20     },
{ 458,0,1942,-20      },
{ 458,5,1995,-20      },
{ 458,10,2056,-20     },
{ 458,15,2138,-20     },
{ 458,20,2269,-20     },
{ 458,25,2478,-20     },
{ 458,30,3667,-20     },
{ 462,-20,793,-20     },
{ 462,-15,1180,-20    },
{ 462,-10,1649,-20    },
{ 462,-5,1737,-20     },
{ 462,0,1794,-20      },
{ 462,5,1854,-20      },
{ 462,10,1928,-20     },
{ 462,15,2031,-20     },
{ 462,20,2186,-20     },
{ 462,25,2435,-20     },
{ 462,30,3619,-20     },
{ 452,-20,1342,-10    },
{ 452,-15,1654,-10    },
{ 452,-10,1936,-10    },
{ 452,-5,1994,-10     },
{ 452,0,2039,-10      },
{ 452,5,2085,-10      },
{ 452,10,2138,-10     },
{ 452,15,2206,-10     },
{ 452,20,2313,-10     },
{ 452,25,2500,-10     },
{ 452,30,3559,-10     },
{ 456,-20,1083,-10    },
{ 456,-15,1426,-10    },
{ 456,-10,1780,-10    },
{ 456,-5,1849,-10     },
{ 456,0,1898,-10      },
{ 456,5,1952,-10      },
{ 456,10,2014,-10     },
{ 456,15,2095,-10     },
{ 456,20,2221,-10     },
{ 456,25,2438,-10     },
{ 456,30,3653,-10     },
{ 457,-20,1051,-10    },
{ 457,-15,1395,-10    },
{ 457,-10,1761,-10    },
{ 457,-5,1832,-10     },
{ 457,0,1880,-10      },
{ 457,5,1935,-10      },
{ 457,10,1998,-10     },
{ 457,15,2080,-10     },
{ 457,20,2213,-10     },
{ 457,25,2424,-10     },
{ 457,30,3710,-10     },
{ 458,-20,1010,-10    },
{ 458,-15,1366,-10    },
{ 458,-10,1740,-10    },
{ 458,-5,1813,-10     },
{ 458,0,1864,-10      },
{ 458,5,1917,-10      },
{ 458,10,1982,-10     },
{ 458,15,2067,-10     },
{ 458,20,2203,-10     },
{ 458,25,2417,-10     },
{ 458,30,3647,-10     },
{ 462,-20,723,-10     },
{ 462,-15,1117,-10    },
{ 462,-10,1578,-10    },
{ 462,-5,1665,-10     },
{ 462,0,1724,-10      },
{ 462,5,1783,-10      },
{ 462,10,1860,-10     },
{ 462,15,1968,-10     },
{ 462,20,2128,-10     },
{ 462,25,2378,-10     },
{ 462,30,3650,-10     },
{ 452,-20,1313,0      },
{ 452,-15,1640,0      },
{ 452,-10,1901,0      },
{ 452,-5,1959,0       },
{ 452,0,2007,0        },
{ 452,5,2054,0        },
{ 452,10,2111,0       },
{ 452,15,2184,0       },
{ 452,20,2297,0       },
{ 452,25,2496,0       },
{ 452,30,3911,0       },
{ 456,-20,1064,0      },
{ 456,-15,1420,0      },
{ 456,-10,1756,0      },
{ 456,-5,1822,0       },
{ 456,0,1874,0        },
{ 456,5,1928,0        },
{ 456,10,1994,0       },
{ 456,15,2079,0       },
{ 456,20,2215,0       },
{ 456,25,2438,0       },
{ 456,30,3911,0       },
{ 457,-20,1030,0      },
{ 457,-15,1390,0      },
{ 457,-10,1734,0      },
{ 457,-5,1804,0       },
{ 457,0,1858,0        },
{ 457,5,1913,0        },
{ 457,10,1978,0       },
{ 457,15,2067,0       },
{ 457,20,2206,0       },
{ 457,25,2435,0       },
{ 457,30,3978,0       },
{ 458,-20,996,0       },
{ 458,-15,1361,0      },
{ 458,-10,1715,0      },
{ 458,-5,1785,0       },
{ 458,0,1840,0        },
{ 458,5,1896,0        },
{ 458,10,1964,0       },
{ 458,15,2054,0       },
{ 458,20,2196,0       },
{ 458,25,2431,0       },
{ 458,30,3925,0       },
{ 462,-20,723,0       },
{ 462,-15,1124,0      },
{ 462,-10,1563,0      },
{ 462,-5,1648,0       },
{ 462,0,1708,0        },
{ 462,5,1773,0        },
{ 462,10,1852,0       },
{ 462,15,1964,0       },
{ 462,20,2132,0       },
{ 462,25,2400,0       },
{ 462,30,3920,0       },
{ 452,-20,1290,10     },
{ 452,-15,1616,10     },
{ 452,-10,1863,10     },
{ 452,-5,1922,10      },
{ 452,0,1970,10       },
{ 452,5,2020,10       },
{ 452,10,2080,10      },
{ 452,15,2157,10      },
{ 452,20,2277,10      },
{ 452,25,2493,10      },
{ 452,30,4091,10      },
{ 456,-20,1050,10     },
{ 456,-15,1408,10     },
{ 456,-10,1724,10     },
{ 456,-5,1791,10      },
{ 456,0,1844,10       },
{ 456,5,1901,10       },
{ 456,10,1969,10      },
{ 456,15,2060,10      },
{ 456,20,2202,10      },
{ 456,25,2448,10      },
{ 456,30,4091,10      },
{ 457,-20,1011,10     },
{ 457,-15,1379,10     },
{ 457,-10,1705,10     },
{ 457,-5,1775,10      },
{ 457,0,1829,10       },
{ 457,5,1887,10       },
{ 457,10,1956,10      },
{ 457,15,2049,10      },
{ 457,20,2195,10      },
{ 457,25,2445,10      },
{ 457,30,4091,10      },
{ 458,-20,985,10      },
{ 458,-15,1352,10     },
{ 458,-10,1687,10     },
{ 458,-5,1757,10      },
{ 458,0,1814,10       },
{ 458,5,1872,10       },
{ 458,10,1941,10      },
{ 458,15,2038,10      },
{ 458,20,2189,10      },
{ 458,25,2440,10      },
{ 458,30,4091,10      },
{ 462,-20,728,10      },
{ 462,-15,1131,10     },
{ 462,-10,1544,10     },
{ 462,-5,1627,10      },
{ 462,0,1689,10       },
{ 462,5,1756,10       },
{ 462,10,1839,10      },
{ 462,15,1957,10      },
{ 462,20,2133,10      },
{ 462,25,2422,10      },
{ 462,30,4091,10      },
{ 452,-20,1253,20     },
{ 452,-15,1599,20     },
{ 452,-10,1824,20     },
{ 452,-5,1884,20      },
{ 452,0,1934,20       },
{ 452,5,1988,20       },
{ 452,10,2051,20      },
{ 452,15,2131,20      },
{ 452,20,2260,20      },
{ 452,25,2496,20      },
{ 452,30,4091,20      },
{ 456,-20,1020,20     },
{ 456,-15,1398,20     },
{ 456,-10,1691,20     },
{ 456,-5,1759,20      },
{ 456,0,1817,20       },
{ 456,5,1873,20       },
{ 456,10,1944,20      },
{ 456,15,2041,20      },
{ 456,20,2193,20      },
{ 456,25,2458,20      },
{ 456,30,4091,20      },
{ 457,-20,987,20      },
{ 457,-15,1369,20     },
{ 457,-10,1673,20     },
{ 457,-5,1744,20      },
{ 457,0,1799,20       },
{ 457,5,1859,20       },
{ 457,10,1933,20      },
{ 457,15,2030,20      },
{ 457,20,2185,20      },
{ 457,25,2455,20      },
{ 457,30,4091,20      },
{ 458,-20,961,20      },
{ 458,-15,1345,20     },
{ 458,-10,1655,20     },
{ 458,-5,1727,20      },
{ 458,0,1785,20       },
{ 458,5,1846,20       },
{ 458,10,1920,20      },
{ 458,15,2020,20      },
{ 458,20,2178,20      },
{ 458,25,2451,20      },
{ 458,30,4091,20      },
{ 462,-20,713,20      },
{ 462,-15,1137,20     },
{ 462,-10,1523,20     },
{ 462,-5,1606,20      },
{ 462,0,1670,20       },
{ 462,5,1739,20       },
{ 462,10,1826,20      },
{ 462,15,1947,20      },
{ 462,20,2132,20      },
{ 462,25,2445,20      },
{ 462,30,4091,20      },
{ 452,-20,1242,25     },
{ 452,-15,1590,25     },
{ 452,-10,1807,25     },
{ 452,-5,1866,25      },
{ 452,0,1917,25       },
{ 452,5,1971,25       },
{ 452,10,2036,25      },
{ 452,15,2118,25      },
{ 452,20,2248,25      },
{ 452,25,2496,25      },
{ 452,30,4091,25      },
{ 456,-20,1013,25     },
{ 456,-15,1394,25     },
{ 456,-10,1675,25     },
{ 456,-5,1745,25      },
{ 456,0,1801,25       },
{ 456,5,1862,25       },
{ 456,10,1935,25      },
{ 456,15,2034,25      },
{ 456,20,2188,25      },
{ 456,25,2458,25      },
{ 456,30,4091,25      },
{ 457,-20,979,25      },
{ 457,-15,1368,25     },
{ 457,-10,1659,25     },
{ 457,-5,1729,25      },
{ 457,0,1787,25       },
{ 457,5,1848,25       },
{ 457,10,1923,25      },
{ 457,15,2022,25      },
{ 457,20,2181,25      },
{ 457,25,2455,25      },
{ 457,30,4091,25      },
{ 458,-20,955,25      },
{ 458,-15,1343,25     },
{ 458,-10,1642,25     },
{ 458,-5,1714,25      },
{ 458,0,1772,25       },
{ 458,5,1834,25       },
{ 458,10,1911,25      },
{ 458,15,2014,25      },
{ 458,20,2174,25      },
{ 458,25,2451,25      },
{ 458,30,4091,25      },
{ 462,-20,713,25      },
{ 462,-15,1139,25     },
{ 462,-10,1513,25     },
{ 462,-5,1596,25      },
{ 462,0,1661,25       },
{ 462,5,1733,25       },
{ 462,10,1819,25      },
{ 462,15,1943,25      },
{ 462,20,2131,25      },
{ 462,25,2445,25      },
{ 462,30,4091,25      },
{ 452,-20,1221,30     },
{ 452,-15,1580,30     },
{ 452,-10,1785,30     },
{ 452,-5,1846,30      },
{ 452,0,1898,30       },
{ 452,5,1953,30       },
{ 452,10,2018,30      },
{ 452,15,2105,30      },
{ 452,20,2239,30      },
{ 452,25,2480,30      },
{ 452,30,4091,30      },
{ 456,-20,996,30      },
{ 456,-15,1383,30     },
{ 456,-10,1656,30     },
{ 456,-5,1747,30      },
{ 456,0,1805,30       },
{ 456,5,1866,30       },
{ 456,10,1940,30      },
{ 456,15,2019,30      },
{ 456,20,2180,30      },
{ 456,25,2458,30      },
{ 456,30,4091,30      },
{ 457,-20,968,30      },
{ 457,-15,1362,30     },
{ 457,-10,1643,30     },
{ 457,-5,1712,30      },
{ 457,0,1771,30       },
{ 457,5,1833,30       },
{ 457,10,1908,30      },
{ 457,15,2010,30      },
{ 457,20,2170,30      },
{ 457,25,2455,30      },
{ 457,30,4091,30      },
{ 458,-20,937,30      },
{ 458,-15,1327,30     },
{ 458,-10,1624,30     },
{ 458,-5,1698,30      },
{ 458,0,1777,30       },
{ 458,5,1839,30       },
{ 458,10,1907,30      },
{ 458,15,2022,30      },
{ 458,20,2164,30      },
{ 458,25,2451,30      },
{ 458,30,4091,30      },
{ 462,-20,713,30      },
{ 462,-15,1137,30     },
{ 462,-10,1500,30     },
{ 462,-5,1582,30      },
{ 462,0,1649,30       },
{ 462,5,1721,30       },
{ 462,10,1809,30      },
{ 462,15,1936,30      },
{ 462,20,2127,30      },
{ 462,25,2459,30      },
{ 462,30,4091,30      },
{ 452,-20,1188,40     },
{ 452,-15,1560,40     },
{ 452,-10,1741,40     },
{ 452,-5,1802,40      },
{ 452,0,1855,40       },
{ 452,5,1913,40       },
{ 452,10,1982,40      },
{ 452,15,2073,40      },
{ 452,20,2215,40      },
{ 452,25,2480,40      },
{ 452,30,4091,40      },
{ 456,-20,973,40      },
{ 456,-15,1370,40     },
{ 456,-10,1619,40     },
{ 456,-5,1709,40      },
{ 456,0,1768,40       },
{ 456,5,1832,40       },
{ 456,10,1911,40      },
{ 456,15,2009,40      },
{ 456,20,2163,40      },
{ 456,25,2458,40      },
{ 456,30,4091,40      },
{ 457,-20,946,40      },
{ 457,-15,1350,40     },
{ 457,-10,1606,40     },
{ 457,-5,1676,40      },
{ 457,0,1734,40       },
{ 457,5,1801,40       },
{ 457,10,1880,40      },
{ 457,15,1990,40      },
{ 457,20,2157,40      },
{ 457,25,2455,40      },
{ 457,30,4091,40      },
{ 458,-20,916,40      },
{ 458,-15,1324,40     },
{ 458,-10,1590,40     },
{ 458,-5,1661,40      },
{ 458,0,1742,40       },
{ 458,5,1808,40       },
{ 458,10,1879,40      },
{ 458,15,1999,40      },
{ 458,20,2152,40      },
{ 458,25,2462,40      },
{ 458,30,4091,40      },
{ 462,-20,698,40      },
{ 462,-15,1144,40     },
{ 462,-10,1474,40     },
{ 462,-5,1556,40      },
{ 462,0,1623,40       },
{ 462,5,1696,40       },
{ 462,10,1791,40      },
{ 462,15,1921,40      },
{ 462,20,2122,40      },
{ 462,25,2471,40      },
{ 462,30,4091,40      },
{ 452,-20,1215,50     },
{ 452,-15,1513,50     },
{ 452,-10,1697,50     },
{ 452,-5,1761,50      },
{ 452,0,1812,50       },
{ 452,5,1874,50       },
{ 452,10,1944,50      },
{ 452,15,2043,50      },
{ 452,20,2193,50      },
{ 452,25,2480,50      },
{ 452,30,4096,50      },
{ 456,-20,956,50      },
{ 456,-15,1358,50     },
{ 456,-10,1530,50     },
{ 456,-5,1671,50      },
{ 456,0,1736,50       },
{ 456,5,1798,50       },
{ 456,10,1886,50      },
{ 456,15,1975,50      },
{ 456,20,2149,50      },
{ 456,25,2445,50      },
{ 456,30,4096,50      },
{ 457,-20,980,50      },
{ 457,-15,1332,50     },
{ 457,-10,1566,50     },
{ 457,-5,1587,50      },
{ 457,0,1706,50       },
{ 457,5,1773,50       },
{ 457,10,1856,50      },
{ 457,15,1969,50      },
{ 457,20,2143,50      },
{ 457,25,2455,50      },
{ 457,30,4095,50      },
{ 458,-20,892,50      },
{ 458,-15,1307,50     },
{ 458,-10,1549,50     },
{ 458,-5,1629,50      },
{ 458,0,1706,50       },
{ 458,5,1781,50       },
{ 458,10,1857,50      },
{ 458,15,1972,50      },
{ 458,20,2144,50      },
{ 458,25,2451,50      },
{ 458,30,4095,50      },
{ 462,-20,698,50      },
{ 462,-15,1131,50     },
{ 462,-10,1447,50     },
{ 462,-5,1529,50      },
{ 462,0,1601,50       },
{ 462,5,1668,50       },
{ 462,10,1774,50      },
{ 462,15,1909,50      },
{ 462,20,2099,50      },
{ 462,25,2469,50      },
{ 462,30,4096,50      },
{ 452,-20,1150,60     },
{ 452,-15,1530,60     },
{ 452,-10,1651,60     },
{ 452,-5,1711,60      },
{ 452,0,1772,60       },
{ 452,5,1786,60       },
{ 452,10,1906,60      },
{ 452,15,2011,60      },
{ 452,20,2178,60      },
{ 452,25,2480,60      },
{ 452,30,4091,60      },
{ 456,-20,970,60      },
{ 456,-15,1353,60     },
{ 456,-10,1546,60     },
{ 456,-5,1627,60      },
{ 456,0,1697,60       },
{ 456,5,1766,60       },
{ 456,10,1846,60      },
{ 456,15,1959,60      },
{ 456,20,2136,60      },
{ 456,25,2458,60      },
{ 456,30,4091,60      },
{ 457,-20,925,60      },
{ 457,-15,1327,60     },
{ 457,-10,1531,60     },
{ 457,-5,1601,60      },
{ 457,0,1663,60       },
{ 457,5,1736,60       },
{ 457,10,1820,60      },
{ 457,15,1940,60      },
{ 457,20,2130,60      },
{ 457,25,2455,60      },
{ 457,30,4091,60      },
{ 458,-20,926,60      },
{ 458,-15,1297,60     },
{ 458,-10,1510,60     },
{ 458,-5,1590,60      },
{ 458,0,1660,60       },
{ 458,5,1730,60       },
{ 458,10,1821,60      },
{ 458,15,1934,60      },
{ 458,20,2124,60      },
{ 458,25,2451,60      },
{ 458,30,4091,60      },
{ 462,-20,673,60      },
{ 462,-15,1102,60     },
{ 462,-10,1409,60     },
{ 462,-5,1491,60      },
{ 462,0,1568,60       },
{ 462,5,1636,60       },
{ 462,10,1751,60      },
{ 462,15,1891,60      },
{ 462,20,2094,60      },
{ 462,25,2450,60      },
{ 462,30,4091,60      }

};

/* ****************************************************************************************************************** */
/* MACRO DEFINITIONS */

/* ****************************************************************************************************************** */
/* TYPE DEFINITIONS */

/* ****************************************************************************************************************** */
/* CONSTANTS */

/* ****************************************************************************************************************** */
/* FILE VARIABLE DEFINITIONS */

/* ****************************************************************************************************************** */
/* FUNCTION DEFINITIONS */
#endif
#endif //if 0
/*******************************************************************************

  Function name: DVR_DAC0_init

  Purpose: Initialize the DAC0 module

  Arguments: None

  Returns: InitSuccessful - true if everything was successful, false if something failed

  Notes: This opens the DAC module

*******************************************************************************/
returnStatus_t DVR_DAC0_init ( void )
{
   returnStatus_t retVal = eSUCCESS;
#if ( MCU_SELECTED == NXP_K24 )
   /* Enable the clock gate to the DAC0 module */
   SIM_SCGC2 |= SIM_SCGC2_DAC0_MASK;

   DAC0_C0 = DAC_C0_DACEN_MASK | DAC_C0_DACRFS_MASK;    /* Enable DAC0 and select DACREF_2 as the reference voltage */
   DAC0_C1 = 0;
   DAC0_C2 = 0;
#elif ( MCU_SELECTED == RA6E1 )
   (void)R_DAC_Open(&g_dac0_ULPC_ctrl, &g_dac0_ULPC_cfg);
   //Enable access to the PFS registers
   R_BSP_PinAccessEnable();
   // 3V6LDO_EN
   R_BSP_PinWrite(BSP_IO_PORT_04_PIN_04, BSP_IO_LEVEL_HIGH);
   //RX0TX1
   R_BSP_PinWrite(BSP_IO_PORT_03_PIN_07, BSP_IO_LEVEL_HIGH);
   //SKY_EN
   R_BSP_PinWrite(BSP_IO_PORT_03_PIN_06, BSP_IO_LEVEL_HIGH);
   // ON DELAY
   R_BSP_SoftwareDelay(1, BSP_DELAY_UNITS_SECONDS);
   //Disable access to the PFS registers
   R_BSP_PinAccessDisable();
#endif


   return ( retVal );
}

/*******************************************************************************

  Function name: DVR_DAC0_setVoltageStep

  Purpose: This function is used to set the DAC voltage

  Arguments: step value to control the output voltage of the DAC0

  Returns: Always success

  Notes:

*******************************************************************************/
void DVR_DAC0_setVoltageStep ( uint16_t stepValue )
{
#if ( MCU_SELECTED == NXP_K24 )
    /* DATA[11:0] controls the output voltage based on the following
      formula: V out = V in * (1 + DACDAT0[11:0])/4096. Buffer mode
      is disabled. */
   DAC0_DAT0L = 0xFF & stepValue;           /* DAC0 DATA0 Low Register (8-Bits LSB) */
   DAC0_DAT0H = 0x0F & ( stepValue >> 8 );  /* DAC0 DATA1 High Register (4-Bits MSB) */
#elif ( MCU_SELECTED == RA6E1 )
      (void)R_DAC_Write(&g_dac0_ULPC_ctrl, stepValue );
      /* Start DAC conversion */
      (void)R_DAC_Start (&g_dac0_ULPC_ctrl);
#endif
}
#if ( MCU_SELECTED == NXP_K24 )
#if ( DAC_CODE_CONFIG == 1 )
/*******************************************************************************

  Function name: DVR_DAC0_setDacCode

  Purpose:

  Arguments:

  Returns: Always success

  Notes:

*******************************************************************************/
returnStatus_t DVR_DAC0_setDacCode ( uint16_t channelNumber, float32_t dBM )
{
   returnStatus_t retVal = eSUCCESS;
   int            i;
   uint16_t       channelRange = 457; /* Assigning 457 as the default value if the channel range doesn't match */
   bool           lookUpSearchSuccessful = false;
   int8_t         powerVal;
   int16_t        radioTemperature;
   int16_t        temperatureCeilingVal;

   /* dBM ceiling table
    ___________________________________
   |   dBm Rrange    |Ceiled dBm Value |
   |-----------------|-----------------|
   | -20 and Above   |   -20           |
   | -19 to -15      |   -15           |
   | -14 to -10      |   -10           |
   | -9 to -5        |   -5            |
   | -4 to -1        |    0            |
   | 0 to 4          |    5            |
   | 5 to 9          |    10           |
   | 10 to 14        |    15           |
   | 15 to 19        |    20           |
   | 20 to 24        |    25           |
   | 25 to 29        |    30           |
   | above 30        |    30           |
   -------------------------------------
   dBM ceiling as per the above table */

   if ( dBM < 0)
   {
      if ( dBM < -20 )
      {
         powerVal = -20;
      }
      else
      {
         powerVal = (  (int8_t)roundf(dBM) - ( (int8_t)roundf(dBM) % 5 ) );
      }
   }
   else
   {
      if ( dBM > 24 )
      {
         powerVal = 30;
      }
      else
      {
         powerVal = (  (int8_t)roundf(dBM) + ( 5 - ( (int8_t)roundf(dBM) % 5 ) ) ) ;
      }
   }

   DBG_logPrintf( 'R', "The ceiled dBM value: %d\n",  powerVal );

/*  ____________________________________________
   |  Channel Rrange | Frequency sub-band (MHz) |
   |-----------------|-----------------         |
   | 190 to 478      |      452                 |
   | 990 to 1079     |      456                 |
   | 1080 to 1168    |      457                 |
   | 1169 to 1258    |      458                 |
   | 1950 to 1990    |      462                 |
   ---------------------------------------------
   Assigning the channel range for the passed channel number as per the above table */
   if ( ( channelNumber >= 190 ) && ( channelNumber <= 478 ) )
   {
      channelRange = 452;
   }
   else if ( ( channelNumber >= 990 ) && ( channelNumber <= 1079 ) )
   {
      channelRange = 456;
   }
   else if ( ( channelNumber >= 1080 ) && ( channelNumber <= 1168 ) )
   {
      channelRange = 457;
   }
   else if ( ( channelNumber >= 1169 ) && ( channelNumber <= 1258 ) )
   {
      channelRange = 458;
   }
   else if ( ( channelNumber >= 1950 ) && ( channelNumber <= 1990 ) )
   {
      channelRange = 462;
   }

   /* WARNING: RADIO_Temperature_Get() should not be called directly by any other task other than PHY_TSK, use PHY_GetRequest instead.
                Using PHY_GetRequest() in PHY_TSK will result in failure as it waits in it's own queue causing a lock-up condition
      NOTE: RADIO_Temperature_Get() will take 1msec delay to acquire the temperature */
#if ( MCU_SELECTED == NXP_K24 )
   if ( RADIO_Temperature_Get( (uint8_t)RADIO_0, &radioTemperature ) )
   {
#elif ( MCU_SELECTED == RA6E1 )
   if ( RADIO_Get_Chip_Temperature( (uint8_t)RADIO_0, &radioTemperature ) )
   {
#endif
      INFO_printf( "RF Algorithm: Radio(phy) Temperature %d\n",  radioTemperature );
   }
   else
   {
      /* If the RADIO_Temperature_Get() API fails, assign the max temperature of 60 degree celcius */
      radioTemperature = 60;
      ERR_printf("Temperature acquistion failed and default value of 60 degree celcius is assigned");
   }

   /*_________________________________________
     | Radio Temperature| Ceiled Temperature |
     |------------------|--------------------|
     | -36 to -40       |      -40           |
     | -35 to -25       |      -30           |
     | -24 to -15       |      -20           |
     | -14 to -5        |      -10           |
     | -4 to 5	        |      0             |
     | 6 to 15	        |      10            |
     | 16 to 20         |      20            |
     | 21 to 25         |      25            |
     | 25 to 35         |      30            |
     | 36 to 45         |      40            |
     | 46 to 55         |      50            |
     | 56 to 70         |      60            |
     -----------------------------------------
   temperature ceiling as per the above table */

   if ( radioTemperature <= -36 )
   {
      temperatureCeilingVal = -40;
   }
   else if ( ( radioTemperature >= -35 ) && ( radioTemperature <= -25 ) )
   {
      temperatureCeilingVal = -30;
   }
   else if ( ( radioTemperature >= -24 ) && ( radioTemperature <= -15 )  )
   {
      temperatureCeilingVal = -20;
   }
   else if ( ( radioTemperature >= -14 ) && ( radioTemperature <= -5 ) )
   {
      temperatureCeilingVal = -10;
   }
   else if ( ( radioTemperature <= 5 ) && ( radioTemperature >= -4 ) )
   {
      temperatureCeilingVal = 0;
   }
   else if ( ( radioTemperature <= 15 ) && ( radioTemperature >= 6 ) )
   {
      temperatureCeilingVal = 10;
   }
   else if ( ( radioTemperature <= 20 ) && ( radioTemperature >= 16 ) )
   {
      temperatureCeilingVal = 20;
   }
   else if ( ( radioTemperature <= 25 ) && ( radioTemperature >= 21 ) )
   {
      temperatureCeilingVal = 25;
   }
   else if ( ( radioTemperature <= 35 ) && ( radioTemperature >= 26 ) )
   {
      temperatureCeilingVal = 30;
   }
   else if ( ( radioTemperature <= 45 ) && ( radioTemperature >= 36 ) )
   {
      temperatureCeilingVal = 40;
   }
   else if ( ( radioTemperature <= 55 ) && ( radioTemperature >= 46 ) )
   {
      temperatureCeilingVal = 50;
   }
   else if ( radioTemperature > 55 )
   {
      temperatureCeilingVal = 60;
   }

   DBG_logPrintf( 'R', "RF Algorithm: Ceiled Temperature val: %d\n",  temperatureCeilingVal );

   for (i = 0; i < ARRAY_IDX_CNT(struct_dacSoteps); i++)
   {
      if ( (struct_dacSoteps[i].frequencyMHz == channelRange) && (struct_dacSoteps[i].temperature == temperatureCeilingVal) && (struct_dacSoteps[i].dBM == powerVal) )
      {
         DBG_logPrintf( 'R', "RF Algorithm: the selected entry: %d and dacStep: %d", i, struct_dacSoteps[i].dacStep );
         int dacOffsetVal;
         /* At max power do not add the offset */
         if ( 30 == powerVal )
         {
            dacOffsetVal = struct_dacSoteps[i].dacStep;
            DBG_logPrintf( 'R', "At max power do not add the offset " );
         }
         else
         {
            dacOffsetVal = struct_dacSoteps[i].dacStep + DVR_DAC0_setOffset( channelNumber );
         }

         DVR_DAC0_setVoltageStep( dacOffsetVal );
         DBG_logPrintf( 'R', "RF Algorithm: DAC offsetvalue %d", dacOffsetVal );
         lookUpSearchSuccessful = true;
         break;
      }
   }

   if ( true == lookUpSearchSuccessful )
   {
#if 0 /* use if power level needs to be changed */
      /* Set Power Level */
      if ( struct_dacSoteps[i].dBM < 0 )
      {
         PowerSetting = 6;
      }
      else
      {
         PowerSetting = 10;
      }

      SetConf = PHY_SetRequest( ePhyAttr_PowerSetting, &PowerSetting);
      if (SetConf.eStatus == ePHY_SET_SUCCESS)
      {
         DBG_printf( "RF Algorithm: Power level is set to %u", PowerSetting );
      }
      else
      {
         DBG_printf( "RF Algorithm: Failed to set power" );
         retVal = eFAILURE;
      }
#endif
   }
   else
   {
      /* If no entry in the LUP table is matching then set max value of 4095 to the DAC */
      DVR_DAC0_setVoltageStep( 4095 );
      ERR_printf( "RF Algorithm: No such entry identified in the LUP table and max value of 4095 is set" );
      retVal = eFAILURE;
   }

   return retVal;
}

/*******************************************************************************

  Function name: DVR_DAC0_setOffset

  Purpose: This function is used to set the DAC voltage

  Arguments: step value to control the output voltage of the DAC0

  Returns: Always success

  Notes:

*******************************************************************************/
int16_t DVR_DAC0_setOffset ( int16_t channelNumber )
{
   int dacOffsetVal;

   if ( ( channelNumber >= 190 ) && ( channelNumber <= 344 ) )
   {
      dacOffsetVal = ULPC_getDacOffset( 0 );
   }
   else if ( ( channelNumber >= 335 ) && ( channelNumber <= 478 ) )
   {
      dacOffsetVal = ULPC_getDacOffset( 1 );
   }
   else if ( ( channelNumber >= 990 ) && ( channelNumber <= 1258 ) )
   {
      dacOffsetVal = ULPC_getDacOffset( 2 );
   }
   else if ( ( channelNumber >= 1950 ) && ( channelNumber <= 1990 ) )
   {
      dacOffsetVal = ULPC_getDacOffset( 3 );
   }

   return dacOffsetVal;
}

/*******************************************************************************

  Function name: DVR_DAC0_disable

  Purpose: Disable the DAC0 module

  Arguments: None

  Returns: None

*******************************************************************************/
void DVR_DAC0_disable(void)
{
   DAC0_C0 &= ~(1 << DAC_C0_DACEN_SHIFT);    /* Disable DAC0 module */
   /* Disable the clock gate to the DAC0 module */
   SIM_SCGC2 &= ~(1 << SIM_SCGC2_DAC0_SHIFT);  // Clear bit - 0xEFFF;
}
#endif
#endif